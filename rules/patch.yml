#
# See technical recommendations on Italian Guidelines:
#
# https://docs.italia.it/italia/piano-triennale-ict/lg-modellointeroperabilita-docs/it/bozza/doc/profili-di-interazione/regole-comuni-rest-soap.html#raccomandazioni-tecniche-per-rest
#
# extends: spectral:oas
rules:
  patch-media-type:
    description: |-
      application/json is not an appropriate media-type for PATCH.
      See https://docs.italia.it/italia/piano-triennale-ict/lg-modellointeroperabilita-docs/it/bozza/doc/profili-di-interazione/regole-comuni-rest-soap.html#usare-lo-schema-problem-json-per-le-risposte-di-errore
    message: |-
      application/json is not an appropriate media-type for PATCH.
    formats:
    - oas3
    severity: error
    recommended: true
    given: >-
      $.[patch][requestBody][content]
    then:
      field: application/json
      function: falsy

  numeric-format:
    description: Number must specify a format.
    message: >-
      Schema of type number must specify a format.
      See https://docs.italia.it/italia/piano-triennale-ict/lg-modellointeroperabilita-docs/it/bozza/doc/profili-di-interazione/regole-comuni-rest-soap.html#definire-format-quando-si-usano-i-tipi-number-ed-integer
    formats:
    - oas3
    severity: error
    recommended: true
    given: >
      $.[?(@.type=="number")]
    then:
      field: format
      function: truthy
  integer-format:
    description: Integer must specify a format.
    message: >-
      Schema of type integer must specify a format.
      See https://docs.italia.it/italia/piano-triennale-ict/lg-modellointeroperabilita-docs/it/bozza/doc/profili-di-interazione/regole-comuni-rest-soap.html#definire-format-quando-si-usano-i-tipi-number-ed-integer
    formats:
    - oas3
    severity: error
    recommended: true
    given: >
      $.[?(@.type=="numeric")]
    then:
      field: format
      function: truthy

